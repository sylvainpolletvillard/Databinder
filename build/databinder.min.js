/*! databinder v 0.6.0 - 2014-06-21
    MIT License - Â© 2014 syllab.fr */
!function(a){function b(a){return Object.prototype.toString.call(a).match(/\s([a-zA-Z]+)/)[1]}function c(a){return"Function"===b(a)}function d(a){return new Error("[Databinder] "+a)}function e(a,b,c){if(j)a.classList[c?"add":"remove"](b);else{var d=a.className.split(" "),e=d.indexOf(b);c&&-1===e?d.push(b):!c&&e>=0&&d.splice(e,1),a.className=d.join(" ").trim()}}function f(c){var d,e=b(c);if(d=e in a?new a[e](c):c,d instanceof Object)for(var f in c)c.hasOwnProperty(f)&&(d[f]=c[f]);return d}var g="data-bind",h="databind",i=/(?:^|,)\s*(?:(\w+):)?\s*([\w\.\/\|\s-]+|{.+})+/g,j="classList"in document.createElement("p"),k=Object.create({set:function(a){return this.scope=l.init(a),this.reset()},reset:function(){return void 0!==this.originalHTML&&(this.elm.innerHTML=this.originalHTML),this.parse(),this},get:function(){for(var a,b=0,c=this.bindings.length;a=this.bindings[b],c>b;b++)(this.elm instanceof HTMLInputElement&&"value"===a.attribute||this.elm instanceof HTMLTextAreaElement&&["value","text","html"].indexOf(a.attribute)>0)&&(this.scope.lookup(a.value,this.elm).data[a.value]=this.elm.value);if(this.elm.children)for(var d=0;d<this.elm.children.length;d++){var e=this.elm.children[d];k.isPrototypeOf(e.databinding)&&e.databinding.get()}return this},getBindings:function(){var a=[],b=this.elm.getAttribute(g);if(""===b)return[{attribute:void 0,value:void 0}];if(null!==b){var c=i.exec(b);if(null===c)throw d("Invalid argument for data-binding: "+b);for(;null!==c;)a.push({attribute:c[1],value:c[2]}),c=i.exec(b)}return a},parse:function(){for(var b,c,e,f=this.scope,g=0,h=this.bindings.length;b=this.bindings[g],h>g;g++){if(void 0===b.value)b.value=this.guessValue();else if("{"===b.value[0]){c={};for(var i=b.value.slice(1,-1).split(","),j=0,k=i.length;k>j;j++){var l=i[j].match(/(\w+):\s*([\w\.\/\|\s]+)/);if(null===l||l.length<3)throw d("Invalid argument for binding set: "+i[j]);c[l[1].trim()]=l[2].trim()}}switch(void 0===b.attribute&&(b.attribute=this.guessAttribute(b.value)),b.attribute){case"text":this.bindText(this.scope.resolve(b.value,this.elm)),f=null;break;case"html":this.bindHTML(this.scope.resolve(b.value,this.elm)),f=null;break;case"with":f=this.scope.lookup(b.value,this.elm,!0);break;case"loop":var m=this.bindLoop(c||{"in":b.value});f=m.scope,e=m.loop;break;case"if":if(this.bindIf(b.value,!0))return;break;case"ifnot":if(this.bindIf(b.value,!1))return;break;case"visible":this.bindVisibility(b.value,!0);break;case"hidden":this.bindVisibility(b.value,!1);break;case"style":this.bindStyle(c||b.value);break;case"class":this.bindClass(c||b.value);break;case"on":this.bindEvents(c);break;case"template":this.bindTemplate(b.value);break;default:if("on"+b.attribute in a){var n={};n[b.attribute]=b.value,this.bindEvents(n)}else this.bindAttribute(b.attribute,this.scope.resolve(b.value,this.elm))}}null!==f&&this.bindChildren(f,e)},bindText:function(a){void 0!==a&&(this.elm.textContent=a)},bindHTML:function(a){a instanceof Element?(this.elm.innerHTML="",this.elm.appendChild(a)):void 0!==a&&(this.elm.innerHTML=a)},bindAttribute:function(a,b){null===b?this.elm.removeAttribute(a):b===!0||b===!1?this.elm[a]=b:void 0!==b&&this.elm.setAttribute(a,b)},bindStyle:function(a){var b,c;if(a instanceof Object)for(b in a)a.hasOwnProperty(b)&&void 0!==(c=this.scope.resolve(a[b],this.elm))&&(this.elm.style[b]=c);else if(a=this.scope.resolve(a,this.elm),a instanceof Object)for(b in a)a.hasOwnProperty(b)&&void 0!==a[b]&&(this.elm.style[b]=a[b]);else this.bindAttribute("style",a)},bindClass:function(a){var b;if(a instanceof Object){for(b in a)if(a.hasOwnProperty(b)){var c=this.scope.resolve(a[b],this.elm);e(this.elm,b,c)}}else if(a=this.scope.resolve(a,this.elm),Array.isArray(a))this.elm.className=a.join(" ");else if(a instanceof Object)for(b in a)a.hasOwnProperty(b)&&e(this.elm,b,a[b]);else this.elm.className=a},bindIf:function(a,b){return Boolean(this.scope.resolve(a,this.elm))!==b?(this.elm.parentNode.removeChild(this.elm),!0):!1},bindVisibility:function(a,b){this.elm.style.display=Boolean(this.scope.resolve(a,this.elm))===b?"":"none"},bindEvents:function(a){function b(a){return function(b){a.call(g.scope.data,b,h.data,g.elm)}}var e,f,g,h;if(void 0===a)throw d('"on" binding expects a binding set, instead got '+a);for(g=this,h=g.scope;h&&h.parent;)h=h.parent;for(e in a)if(a.hasOwnProperty(e)&&(f=this.scope.resolve(a[e],g.elm,!0),c(f))){var i=b(f);e in this.eventListeners&&this.elm.removeEventListener(e,this.eventListeners[e]),this.eventListeners[e]=i,this.elm.addEventListener(e,i)}},bindLoop:function(a){if(void 0===a["in"])throw d("No list specified for loop declaration: "+a);return{scope:this.scope.lookup(a["in"],this.elm,!1),loop:{list:a["in"],index:a.at||"loopIndex",item:a.as||"loopValue"}}},bindTemplate:function(a){var b=document.getElementById(a);if(null===b)throw d("Template not found: "+a);this.elm.innerHTML=b.innerHTML},bindChildren:function(a,b){function d(c,d){var e,g=f(i[d]),n=l.init(g,a);for(n.loopIteration=b,n.data[b.index]=d,n.data[b.item]=i[d],e=0;e<h.length;e++)j=h[e].cloneNode(!0),c.appendChild(j),j instanceof Element&&m(j).set(n);k&&(i=a.evalFunction(k))}var e,g,h,i,j,k;if(l.isPrototypeOf(a))if(h=[],void 0!==b){for(g=0;g<this.elm.childNodes.length;g++)h.push(this.elm.childNodes[g].cloneNode(!0));if(this.elm.innerHTML="",i=a.data[b.list],c(i)&&(k=i,i=a.evalFunction(i)),Array.isArray(i))for(e=0;e<i.length;e++)d(this.elm,e);else if(i instanceof Object)for(e in i)i.hasOwnProperty(e)&&d(this.elm,e)}else if(this.elm.children){for(g=0;g<this.elm.children.length;g++)h.push(this.elm.children[g]);for(g=0;g<h.length;g++)h[g]instanceof Element&&m(h[g]).set(a)}},guessValue:function(){var a,b,c=[],e=this.elm.id,f=this.elm.getAttribute("name"),g=this.elm.className.split(" ");for(c=c.concat(e).concat(f).concat(g),a=0;a<c.length;a++)if(c[a]&&null!==(b=this.scope.resolve(c[a],this.elm)))return c[a];throw d("No binding value suitable for element "+this.elm.outerHTML)},guessAttribute:function(a){var c=this.scope.resolve(a,this.elm),d=b(c);switch(!0){case"Object"===d:return"with";case"Array"===d:return"loop";case c instanceof Element:return"html";case"Boolean"===d:return"HTMLInputElement"===b(this.elm)&&"checked"in this.elm?"checked":"HTMLOptionElement"===b(this.elm)?"selected":"if";case"String"===d:case"Number"===d:return"HTMLInputElement"===b(this.elm)?"value":"src"in this.elm?"src":"text";default:return"text"}}}),l=Object.create({init:function(a,b){if(l.isPrototypeOf(a))return a;var c=Object.create(l);return c.data=a||{},c.parent=b,c},lookup:function(a,b,d){var e,f,g,h,i=this;if("."===a)return i;if("/"===a[0]){for(;i.parent;)i=i.parent;a=a.slice(1)}else if("."===a[0]){for(g=0;"."===a[++g]&&i.parent;)i=i.parent;a=a.slice(g)}else for(e=a.split(".")[0];void 0===i.data[e]&&i.parent;)i=i.parent;for(f=a.split("."),e=i.data,g=0,h=f.length-1,d===!0&&h++;void 0!==e&&h>g;)e=e[f[g++]],c(e)&&(e=this.evalFunction(e,b)),i=l.init(e,i);return i},evalFunction:function(a,b){var d;if(c(a)){for(d=this;d&&d.parent;)d=d.parent;a=a.call(this.data,d.data,b)}return a},resolve:function(a,b,e){var f,g,h,i,j,k=a.split("|"),l=k.shift().trim(),n=this.lookup(l,b,!1);if(a=n.data[l.match(/([^/\.\s]+)\s*$/)[1]],!e)for(a=this.evalFunction(a,b),f=0,g=k.length;g>f;f++){if(h=k[f].trim().split(/\s+/),j=h.shift(),i=m.extensions[j],void 0===i||!c(i))throw d("Unknown extension: "+j);a=i.call(a,h)}return a}}),m=function(a){var b=a instanceof Element?a:document.querySelector(a);if(null===b)throw d("No element matched for selector "+a);if(b.databinding)return b.databinding;var c=Object.create(k);return c.eventListeners={},c.originalHTML=b.innerHTML,c.elm=b,c.bindings=c.getBindings(),b.databinding=c,c};return m.extensions={},a[h]=m,m}(this);