/*! Databinder v 0.9.0 - 2015-08-24
   License MIT - Â© 2015 http://syllab.fr/projets/web/databinder */
!function(a){function b(a){return"function"==typeof a}function c(a){return"object"==typeof a}function d(a){switch(typeof a){case"string":return new String(a);case"number":return new Number(a);case"boolean":return new Boolean(a);default:return a}}function e(a,b,c){if(n)a.classList[c?"add":"remove"](b);else{var d=a.className.split(" "),e=d.indexOf(b);c&&-1===e?d.push(b):!c&&e>=0&&d.splice(e,1),a.className=d.join(" ").trim()}}function g(a){this.name="DatabinderError",this.message=a}function h(a){this.bindings={},this.originalInnerHTML=a.innerHTML,this.element=a,a.databinding=this}function i(a,b){return a instanceof i?a:(this.observers={},this.data=this.makeObservable(d(a||{})),void(this.parent=b))}function j(c,d,e){var f;k.bindings.hasOwnProperty(d)?f=k.bindings[d]:"on"+d in a?(f=k.bindings.on,e="{"+d+":"+e+"}"):f=k.defaultBinding;for(var g in f)f.hasOwnProperty(g)&&(this[g]=f[g]);this.element=c,this.attribute=d,this.declaration="{"===e[0]?this.getBindingSet(e):e,this.inputable=-1===e.indexOf("|")&&b(this.get),this.inputable&&-1!==["INPUT","TEXTAREA","SELECT"].indexOf(this.element.tagName)&&this.element.addEventListener("change",this.element.databinding.get.bind(this.element.databinding)),b(this.init)&&this.init()}function k(a,b){var c=a instanceof Element?a:document.querySelector(a);if(null===c)throw new g("No element matched for selector "+a);var d=c.databinding||new h(c);return void 0!==b&&d.set(b),d}var l="data-bind",m="databind",n="classList"in document.createElement("p");g.prototype=new Error,g.prototype.constructor=g;var o,p=/(?:^|,)\s*(?:(\w+)\s*:)?\s*([\w\.\/\|'"\s-]+|{.+})+/g;h.prototype={set:function(a){return this.scope=new i(a,null),this.innerScope=this.scope,this.data=this.scope.data,this.bindings=this.getBindings(),this.reset()},reset:function(){return void 0!==this.originalInnerHTML&&(this.element.innerHTML=this.originalInnerHTML),this.applyBindings(),this},get:function(){for(var a in this.bindings)this.bindings.hasOwnProperty(a)&&this.bindings[a].inputable&&this.scope.setValueFromBinding(this.bindings[a]);if(this.element.children)for(var b=0,c=this.element.children.length;c>b;b++){var d=this.element.children[b];d.databinding instanceof h&&d.databinding.get()}return this},getBindings:function(){var a,b,c,d={};if(this.element.hasAttribute(l))if(c=this.element.getAttribute(l)){var e=p.exec(c);if(null===e)throw new g("Invalid argument for data-binding: "+c);for(;null!==e;)b=e[2],a=e[1]||this.guessAttribute(b),d[a]=new j(this.element,a,b),e=p.exec(c)}else b=this.guessValue(),a=this.guessAttribute(b),null!==a&&(d[a]=new j(this.element,a,b));return d},applyBindings:function(){for(var a in this.bindings)if(this.bindings.hasOwnProperty(a)&&(o=this.bindings[a],o.set(this.scope)===!1))return;o=null,null!==this.innerScope&&this.parseChildren(this.innerScope)},parseChildren:function(a){var b,c;if(a instanceof i&&this.element.children){for(c=[],b=0;b<this.element.children.length;b++)c.push(this.element.children[b]);for(b=0;b<c.length;b++)c[b]instanceof Element&&k(c[b]).set(a)}},guessValue:function(){var a,b,c=[];for(c=c.concat(this.element.id||[]).concat(this.element.getAttribute("name")||[]).concat(this.element.className.match(/[^ ]+/g)||[]),a=0;a<c.length;a++)if(c[a]&&null!==(b=this.scope.resolve(c[a],!0)))return c[a];throw new g("No binding value suitable for element",this.element)},guessAttribute:function(a){var c=this.scope.resolve(a,!0);if(null===c||void 0===c)return null;if(b(c))throw new g("Cannot guess binding when value is a function",this.element);var d=c.constructor;switch(!0){case d===Object:return"with";case d===Array:return"loop";case c instanceof Element:return"html";case d===Boolean:return this.element.constructor===HTMLInputElement&&"checked"in this.element?"checked":this.element.constructor===HTMLOptionElement?"selected":"if";case d===String:case d===Number:return this.element.constructor===HTMLInputElement?"value":"src"in this.element?"src":"text";default:return"text"}}};var q=["pop","push","reverse","shift","sort","splice","unshift"],r={SET:"SET",SPLICE:"SPLICE"};i.prototype={lookup:function(a,b){var d,e,f,g,h=this,j=this.data;if("."===a)return h;if("/"===a[0]){for(;h.parent;)h=h.parent;j=h.data,a=a.slice(1)}else if("."===a[0]){for(f=0;"."===a[++f]&&h.parent;)h=h.parent;j=h.data,a=a.slice(f)}else for(d=a.split(".")[0];h.parent&&(j=h.data,!c(j)||!j.hasOwnProperty(d));)h=h.parent;for(e=a.split("."),f=0,g=e.length-1,b===!0&&g++;void 0!==j&&g>f;)j=this.evalFunction(j[e[f++]]),h=new i(j,h);return h},evalFunction:function(a){var c;if(b(a)){for(c=this;c&&c.parent;)c=c.parent;a=a.call(this.data,c.data,o.element)}return a},resolve:function(a,c){var d,e,f,h,i,j,l,m,n=a.split("|"),o=this.resolveParam(n.shift().trim()).value;if(c||(o=this.evalFunction(o)),n.length>0)for(d=0,e=n.length;e>d;d++){if(i=n[d].trim().split(/\s+/),m=i.shift(),l=k.extensions[m],void 0===l||!b(l))throw new g("Unknown extension: "+m);for(j=[],f=0,h=i.length;h>f;f++)j.push(this.resolveParam(i[f]).value);o=l.apply(o,j)}return o},resolveParam:function(a){var b,c;return isNaN(+a)?'"'===a[0]||"'"===a[0]?{value:a.slice(1,-1)}:(c=this.lookup(a,!1),"."===a?{value:c.data,parent:c,prop:"data"}:(b=a.match(/([^\/\.\s]+)\s*$/)[1],{value:c.data[b],parent:c.data,prop:b})):{value:+a}},setValueFromBinding:function(a){var b=this.resolveParam(a.declaration.split("|")[0].trim());b.parent&&b.prop&&(b.parent[b.prop]=a.get())},makeObservable:function(a,c){var d,e=this,f=Array.isArray(a);if(f)d=a.slice();else if(b(a))d=function(){return a.apply(this,arguments)};else{if("[object Object]"!==Object.prototype.toString.call(a))return a;d=Object.create(Object.getPrototypeOf(a),{})}if(f){var g=c||".";q.forEach(function(b){Object.defineProperty(d,b,{configurable:!0,value:function(){var d,f,h,i;switch(b){case"pop":d=a.length-1,h=1,f=0;break;case"push":d=a.length,h=0,f=arguments.length;break;case"reverse":case"sort":d=0,h=a.length,f=a.length;break;case"shift":d=0,h=1,f=0;break;case"unshift":d=0,h=0,f=arguments.length;break;case"splice":d=arguments[0],h=arguments[1],f=arguments.length-2}return i=a[b].apply(a,arguments),e.makeObservable(a,c),e.callObservers(r.SPLICE,g,d,h,f),i}})})}return Object.getOwnPropertyNames(a).forEach(function(b){var f=c?c+"."+b:b,g=Object.getOwnPropertyDescriptor(a,b);g&&g.configurable&&(g.get=function(){return f in e.observers||(e.observers[f]=[]),o&&-1===e.observers[f].indexOf(o)&&e.observers[f].push(o),a[b]instanceof Object?e.makeObservable(a[b],f):a[b]},g.set=function(c){a[b]=c,e.callObservers(r.SET,f,c),f in e.observers&&e.observers[f].forEach(function(a){a.react(r.SET,f,c)})},delete g.value,delete g.writable,Object.defineProperty(d,b,g))}),d},callObservers:function(a,b){if(b in this.observers){var c,d,e=this.observers[b];for(c=0,d=e.length;d>c;c++)e[c].react.apply(e[c],arguments)}}},j.prototype={getBindingSet:function(a){for(var b={},c=a.slice(1,-1).split(","),d=0,e=c.length;e>d;d++){var f=c[d].match(/(\w+):\s*([\w\.\/\|\s]+)/);if(null===f||f.length<3)throw new g("Invalid argument for binding set: "+c[d]);b[f[1].trim()]=f[2].trim()}return b},react:function(){o=this,this.set(this.element.databinding.scope)}},k.bindings={},k.extensions={},k.bindings["class"]={get:function(){return n?this.element.classList:this.element.className.split(/\s+/)},set:function(a){var b;if(this.declaration instanceof Object)for(b in this.declaration)this.declaration.hasOwnProperty(b)&&e(this.element,b,a.resolve(this.declaration[b]));else{var c=a.resolve(this.declaration);if(Array.isArray(c))this.element.className=c.join(" ");else if(c instanceof Object)for(b in c)c.hasOwnProperty(b)&&e(this.element,b,c[b]);else this.element.className=c}}},k.defaultBinding={get:function(){return this.attribute in this.element?this.element[this.attribute]:this.element.getAttribute(this.attribute)},set:function(a){var b=a.resolve(this.declaration);null===b?this.element.removeAttribute(this.attribute):this.attribute in this.element?this.element[this.attribute]=b:void 0!==b&&this.element.setAttribute(this.attribute,b)}},k.bindings.hidden={get:function(){return this.element.hidden},set:function(a){return k.bindings.visible.set.call(this,a,!0)}},k.bindings.html={init:function(){this.element.databinding.innerScope=null},get:function(){return this.element.innerHTML},set:function(a){var b=a.resolve(this.declaration);b instanceof Element?(this.element.innerHTML="",this.element.appendChild(b)):void 0!==b&&(this.element.innerHTML=b)}},k.bindings["if"]={init:function(){this.parentNode=this.element.parentNode},get:function(){return this.parentNode.childNodes.indexOf(this.element)>=0},set:function(a,b){var c=a.resolve(this.declaration);return Boolean(c)===Boolean(b)?(this.parentNode&&this.parentNode.removeChild(this.element),!1):void 0}},k.bindings.ifnot={init:function(){return k.bindings["if"].init.apply(this,arguments)},get:function(){return!k.bindings["if"].get.apply(this,arguments)},set:function(a){return k.bindings["if"].set.call(this,a,!0)}},k.bindings.loop={init:function(){this.element.databinding.innerScope=null},get:function(){return this.element.childNodes},set:function(a){var b=c(this.declaration)?this.declaration:{"in":this.declaration};if(void 0===b["in"])throw new g("No list specified for loop declaration: "+b);this.list=b["in"],this.index=b.at||"loopIndex",this.item=b.as||"loopValue",this.childNodes=[],this.innerScope=a.lookup(this.list,!1);for(var d=0,e=this.element.childNodes.length;e>d;d++)this.childNodes.push(this.element.childNodes[d].cloneNode(!0));this.element.innerHTML="",this.parseChildren()},parseChildren:function(){var a,c,d,e;if(this.iterations=[],this.innerScope instanceof i){if(e=this.innerScope.resolve(this.list,!0),Array.isArray(e))for(a=0,c=e.length;c>a;a++)this.iterations.push({key:a,value:e[a]});else if(b(e))for(a=0;null!==(d=this.innerScope.evalFunction(e));a++)this.iterations.push({key:a,value:d});else if(e instanceof Object)for(a in e)e.hasOwnProperty(a)&&this.iterations.push({key:a,value:e[a]});for(a=0;a<this.iterations.length;a++)this.iterate(a)}},iterate:function(a){var b,c,d,e=this.iterations[a],f=new i(e.value,this.innerScope);for(f.data[this.index]=e.key,f.data[this.item]=e.value,e.nodes=[],b=0,c=this.childNodes.length;c>b;b++)d=this.childNodes[b].cloneNode(!0),e.nodes.push(d),this.iterations[a+1]&&this.iterations[a+1].nodes?this.element.insertBefore(d,this.iterations[a+1].nodes[0]):this.element.appendChild(d),d instanceof Element&&k(d).set(f)},react:function(a,b){if(a===r.SPLICE)this.splice.apply(this,[].slice.call(arguments,2));else if(a===r.SET){var c,d,e,f=b.split(".");if(f.length>1){for(e=f[1],c=0,d=this.iterations.length;d>c;c++)if(e==this.iterations[c].key){this.splice(c,1,1);break}}else this.parseChildren()}},splice:function(a,b,c){var d,e,f,g;for(d=a;a+b>d&&d in this.iterations;d++)for(e=0,f=this.iterations[d].nodes.length;f>e;e++)this.element.removeChild(this.iterations[d].nodes[e]);for(g=this.innerScope.resolve(this.list,!0),d=a;a+c>d;d++)this.iterations[d]={key:d,value:g[d]},this.iterate(d)}},k.bindings.on={init:function(){this.eventListeners={}},set:function(a){function d(b,c){return function(d){b.call(a.data,d,h.data,c)}}if(!c(this.declaration))throw new g('"on" binding expects a binding set, instead got '+this.declaration);for(var e,f,h=a;h&&h.parent;)h=h.parent;for(e in this.declaration)if(this.declaration.hasOwnProperty(e)&&(f=a.resolve(this.declaration[e],!0),b(f))){var i=d(f,this.element);e in this.eventListeners&&this.element.removeEventListener(e,this.eventListeners[e]),this.eventListeners[e]=i,this.element.addEventListener(e,i)}}},k.bindings.style={get:function(){return this.element.style},set:function(a){var b,c;if(this.declaration instanceof Object)for(b in this.declaration)this.declaration.hasOwnProperty(b)&&(c=a.resolve(this.declaration[b]),void 0!==c&&(this.element.style[b]=c));else if(c=a.resolve(this.declaration),c instanceof Object)for(b in c)c.hasOwnProperty(b)&&void 0!==c[b]&&(this.element.style[b]=c[b]);else this.element.setAttribute("style",c)}},k.bindings.template={set:function(a){var b=a.resolve(this.declaration),c=document.getElementById(b);if(null===c)throw new g("Template not found: "+b);this.element.innerHTML=c.innerHTML}},k.bindings.text={init:function(){this.element.databinding.innerScope=null},get:function(){return this.element.textContent},set:function(a){var b=a.resolve(this.declaration);void 0!==b&&(this.element.textContent=b)}},k.bindings.visible={get:function(){return!this.element.hidden},set:function(a,b){var c=a.resolve(this.declaration),d=Boolean(c)===Boolean(b);this.element.hidden=d,this.element.style.display=d?"none":""}},k.bindings["with"]={set:function(a){var b=a.resolve(this.declaration);this.element.databinding.innerScope=new i(b,a)}},k.extensions.between=function(a,b){var c=Array.isArray(this)?this.length:+this;return c>=a&&b>=c},k.extensions.capitalize=function(){return String(this).charAt(0).toUpperCase()+String(this).slice(1)},k.extensions.ceil=function(a){var b=Math.pow(10,0|a);return Math.ceil(b*+this)/b},k.extensions.date=function(){return new Date(this).toLocaleDateString()},k.extensions.equals=function(a){return this==a},k.extensions.every=k.extensions.all=function(a){return Array.isArray(this)&&this.every("function"==typeof a?a:function(b){return b[a]})},k.extensions.filter=function(a){return"string"==typeof a?Array.isArray(this)&&this.filter(function(b){return b[a]}):Array.isArray(this)?this.filter(a,this):[]},k.extensions.floor=function(a){var b=Math.pow(10,0|a);return Math.floor(b*+this)/b},k.extensions.lowercase=String.prototype.toLowerCase,k.extensions.moreThan=function(a){return(Array.isArray(this)?this.length:+this)>a},k.extensions.none=function(a){return null===this||void 0===this||0===this.length||Array.isArray(this)&&!this.some("function"==typeof f?f:function(a){return a[f]})},k.extensions.not=function(a){return Array.isArray(this)?this.filter(function(b){return!b[a]}):this!=a},k.extensions.number=function(){return Array.isArray(this)?this.length:Number(this)},k.extensions.round=function(a){var b=Math.pow(10,0|a);return Math.round(b*+this)/b},k.extensions.some=function(a){return void 0===a?(Array.isArray(this)?this.length:+this)>0:Array.isArray(this)&&this.some("function"==typeof a?a:function(b){return b[a]})},k.extensions.sort=function(a){return Array.isArray(this)?this.sort(a):[]},k.extensions.time=function(){return new Date(this).toLocaleTimeString()},k.extensions.trim=String.prototype.trim,k.extensions.uppercase=String.prototype.toUpperCase,a[m]=k}(this);