/*! Databinder v 0.9.0 - 2015-08-24
   License MIT - Â© 2015 http://syllab.fr/projets/web/databinder */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a[DB_GLOBAL]=b()}(this,function(){function a(a){return"function"==typeof a}function b(a){return"object"==typeof a}function c(a){switch(typeof a){case"string":return new String(a);case"number":return new Number(a);case"boolean":return new Boolean(a);default:return a}}function d(a,b,c){if(l)a.classList[c?"add":"remove"](b);else{var d=a.className.split(" "),e=d.indexOf(b);c&&-1===e?d.push(b):!c&&e>=0&&d.splice(e,1),a.className=d.join(" ").trim()}}function e(a){this.name="DatabinderError",this.message=a}function g(a){this.bindings={},this.originalInnerHTML=a.innerHTML,this.element=a,a.databinding=this}function h(a,b){return a instanceof h?a:(this.observers={},this.data=this.makeObservable(c(a||{})),void(this.parent=b))}function i(b,c,d){var e;j.bindings.hasOwnProperty(c)?e=j.bindings[c]:"on"+c in global?(e=j.bindings.on,d="{"+c+":"+d+"}"):e=j.defaultBinding;for(var f in e)e.hasOwnProperty(f)&&(this[f]=e[f]);this.element=b,this.attribute=c,this.declaration="{"===d[0]?this.getBindingSet(d):d,this.inputable=-1===d.indexOf("|")&&a(this.get),this.inputable&&-1!==["INPUT","TEXTAREA","SELECT"].indexOf(this.element.tagName)&&this.element.addEventListener("change",this.element.databinding.get.bind(this.element.databinding)),a(this.init)&&this.init()}function j(a,b){var c=a instanceof Element?a:document.querySelector(a);if(null===c)throw new e("No element matched for selector "+a);var d=c.databinding||new g(c);return void 0!==b&&d.set(b),d}var k="data-bind",l="classList"in document.createElement("p");e.prototype=new Error,e.prototype.constructor=e;var m,n=/(?:^|,)\s*(?:(\w+)\s*:)?\s*([\w\.\/\|'"\s-]+|{.+})+/g;g.prototype={set:function(a){return this.scope=new h(a,null),this.innerScope=this.scope,this.data=this.scope.data,this.bindings=this.getBindings(),this.reset()},reset:function(){return void 0!==this.originalInnerHTML&&(this.element.innerHTML=this.originalInnerHTML),this.applyBindings(),this},get:function(){for(var a in this.bindings)this.bindings.hasOwnProperty(a)&&this.bindings[a].inputable&&this.scope.setValueFromBinding(this.bindings[a]);if(this.element.children)for(var b=0,c=this.element.children.length;c>b;b++){var d=this.element.children[b];d.databinding instanceof g&&d.databinding.get()}return this},getBindings:function(){var a,b,c,d={};if(this.element.hasAttribute(k))if(c=this.element.getAttribute(k)){var f=n.exec(c);if(null===f)throw new e("Invalid argument for data-binding: "+c);for(;null!==f;)b=f[2],a=f[1]||this.guessAttribute(b),d[a]=new i(this.element,a,b),f=n.exec(c)}else b=this.guessValue(),a=this.guessAttribute(b),null!==a&&(d[a]=new i(this.element,a,b));return d},applyBindings:function(){for(var a in this.bindings)if(this.bindings.hasOwnProperty(a)&&(m=this.bindings[a],m.set(this.scope)===!1))return;m=null,null!==this.innerScope&&this.parseChildren(this.innerScope)},parseChildren:function(a){var b,c;if(a instanceof h&&this.element.children){for(c=[],b=0;b<this.element.children.length;b++)c.push(this.element.children[b]);for(b=0;b<c.length;b++)c[b]instanceof Element&&j(c[b]).set(a)}},guessValue:function(){var a,b,c=[];for(c=c.concat(this.element.id||[]).concat(this.element.getAttribute("name")||[]).concat(this.element.className.match(/[^ ]+/g)||[]),a=0;a<c.length;a++)if(c[a]&&null!==(b=this.scope.resolve(c[a],!0)))return c[a];throw new e("No binding value suitable for element",this.element)},guessAttribute:function(b){var c=this.scope.resolve(b,!0);if(null===c||void 0===c)return null;if(a(c))throw new e("Cannot guess binding when value is a function",this.element);var d=c.constructor;switch(!0){case d===Object:return"with";case d===Array:return"loop";case c instanceof Element:return"html";case d===Boolean:return this.element.constructor===HTMLInputElement&&"checked"in this.element?"checked":this.element.constructor===HTMLOptionElement?"selected":"if";case d===String:case d===Number:return this.element.constructor===HTMLInputElement?"value":"src"in this.element?"src":"text";default:return"text"}}};var o=["pop","push","reverse","shift","sort","splice","unshift"],p={SET:"SET",SPLICE:"SPLICE"};return h.prototype={lookup:function(a,c){var d,e,f,g,i=this,j=this.data;if("."===a)return i;if("/"===a[0]){for(;i.parent;)i=i.parent;j=i.data,a=a.slice(1)}else if("."===a[0]){for(f=0;"."===a[++f]&&i.parent;)i=i.parent;j=i.data,a=a.slice(f)}else for(d=a.split(".")[0];i.parent&&(j=i.data,!b(j)||!j.hasOwnProperty(d));)i=i.parent;for(e=a.split("."),f=0,g=e.length-1,c===!0&&g++;void 0!==j&&g>f;)j=this.evalFunction(j[e[f++]]),i=new h(j,i);return i},evalFunction:function(b){var c;if(a(b)){for(c=this;c&&c.parent;)c=c.parent;b=b.call(this.data,c.data,m.element)}return b},resolve:function(b,c){var d,f,g,h,i,k,l,m,n=b.split("|"),o=this.resolveParam(n.shift().trim()).value;if(c||(o=this.evalFunction(o)),n.length>0)for(d=0,f=n.length;f>d;d++){if(i=n[d].trim().split(/\s+/),m=i.shift(),l=j.extensions[m],void 0===l||!a(l))throw new e("Unknown extension: "+m);for(k=[],g=0,h=i.length;h>g;g++)k.push(this.resolveParam(i[g]).value);o=l.apply(o,k)}return o},resolveParam:function(a){var b,c;return isNaN(+a)?'"'===a[0]||"'"===a[0]?{value:a.slice(1,-1)}:(c=this.lookup(a,!1),"."===a?{value:c.data,parent:c,prop:"data"}:(b=a.match(/([^\/\.\s]+)\s*$/)[1],{value:c.data[b],parent:c.data,prop:b})):{value:+a}},setValueFromBinding:function(a){var b=this.resolveParam(a.declaration.split("|")[0].trim());b.parent&&b.prop&&(b.parent[b.prop]=a.get())},makeObservable:function(b,c){var d,e=this,f=Array.isArray(b);if(f)d=b.slice();else if(a(b))d=function(){return b.apply(this,arguments)};else{if("[object Object]"!==Object.prototype.toString.call(b))return b;d=Object.create(Object.getPrototypeOf(b),{})}if(f){var g=c||".";o.forEach(function(a){Object.defineProperty(d,a,{configurable:!0,value:function(){var d,f,h,i;switch(a){case"pop":d=b.length-1,h=1,f=0;break;case"push":d=b.length,h=0,f=arguments.length;break;case"reverse":case"sort":d=0,h=b.length,f=b.length;break;case"shift":d=0,h=1,f=0;break;case"unshift":d=0,h=0,f=arguments.length;break;case"splice":d=arguments[0],h=arguments[1],f=arguments.length-2}return i=b[a].apply(b,arguments),e.makeObservable(b,c),e.callObservers(p.SPLICE,g,d,h,f),i}})})}return Object.getOwnPropertyNames(b).forEach(function(a){var f=c?c+"."+a:a,g=Object.getOwnPropertyDescriptor(b,a);g&&g.configurable&&(g.get=function(){return f in e.observers||(e.observers[f]=[]),m&&-1===e.observers[f].indexOf(m)&&e.observers[f].push(m),b[a]instanceof Object?e.makeObservable(b[a],f):b[a]},g.set=function(c){b[a]=c,e.callObservers(p.SET,f,c),f in e.observers&&e.observers[f].forEach(function(a){a.react(p.SET,f,c)})},delete g.value,delete g.writable,Object.defineProperty(d,a,g))}),d},callObservers:function(a,b){if(b in this.observers){var c,d,e=this.observers[b];for(c=0,d=e.length;d>c;c++)e[c].react.apply(e[c],arguments)}}},i.prototype={getBindingSet:function(a){for(var b={},c=a.slice(1,-1).split(","),d=0,f=c.length;f>d;d++){var g=c[d].match(/(\w+):\s*([\w\.\/\|\s]+)/);if(null===g||g.length<3)throw new e("Invalid argument for binding set: "+c[d]);b[g[1].trim()]=g[2].trim()}return b},react:function(){m=this,this.set(this.element.databinding.scope)}},j.bindings={},j.extensions={},j.bindings["class"]={get:function(){return l?this.element.classList:this.element.className.split(/\s+/)},set:function(a){var b;if(this.declaration instanceof Object)for(b in this.declaration)this.declaration.hasOwnProperty(b)&&d(this.element,b,a.resolve(this.declaration[b]));else{var c=a.resolve(this.declaration);if(Array.isArray(c))this.element.className=c.join(" ");else if(c instanceof Object)for(b in c)c.hasOwnProperty(b)&&d(this.element,b,c[b]);else this.element.className=c}}},j.defaultBinding={get:function(){return this.attribute in this.element?this.element[this.attribute]:this.element.getAttribute(this.attribute)},set:function(a){var b=a.resolve(this.declaration);null===b?this.element.removeAttribute(this.attribute):this.attribute in this.element?this.element[this.attribute]=b:void 0!==b&&this.element.setAttribute(this.attribute,b)}},j.bindings.hidden={get:function(){return this.element.hidden},set:function(a){return j.bindings.visible.set.call(this,a,!0)}},j.bindings.html={init:function(){this.element.databinding.innerScope=null},get:function(){return this.element.innerHTML},set:function(a){var b=a.resolve(this.declaration);b instanceof Element?(this.element.innerHTML="",this.element.appendChild(b)):void 0!==b&&(this.element.innerHTML=b)}},j.bindings["if"]={init:function(){this.parentNode=this.element.parentNode},get:function(){return this.parentNode.childNodes.indexOf(this.element)>=0},set:function(a,b){var c=a.resolve(this.declaration);return Boolean(c)===Boolean(b)?(this.parentNode&&this.parentNode.removeChild(this.element),!1):void 0}},j.bindings.ifnot={init:function(){return j.bindings["if"].init.apply(this,arguments)},get:function(){return!j.bindings["if"].get.apply(this,arguments)},set:function(a){return j.bindings["if"].set.call(this,a,!0)}},j.bindings.loop={init:function(){this.element.databinding.innerScope=null},get:function(){return this.element.childNodes},set:function(a){var c=b(this.declaration)?this.declaration:{"in":this.declaration};if(void 0===c["in"])throw new e("No list specified for loop declaration: "+c);this.list=c["in"],this.index=c.at||"loopIndex",this.item=c.as||"loopValue",this.childNodes=[],this.innerScope=a.lookup(this.list,!1);for(var d=0,f=this.element.childNodes.length;f>d;d++)this.childNodes.push(this.element.childNodes[d].cloneNode(!0));this.element.innerHTML="",this.parseChildren()},parseChildren:function(){var b,c,d,e;if(this.iterations=[],this.innerScope instanceof h){if(e=this.innerScope.resolve(this.list,!0),Array.isArray(e))for(b=0,c=e.length;c>b;b++)this.iterations.push({key:b,value:e[b]});else if(a(e))for(b=0;null!==(d=this.innerScope.evalFunction(e));b++)this.iterations.push({key:b,value:d});else if(e instanceof Object)for(b in e)e.hasOwnProperty(b)&&this.iterations.push({key:b,value:e[b]});for(b=0;b<this.iterations.length;b++)this.iterate(b)}},iterate:function(a){var b,c,d,e=this.iterations[a],f=new h(e.value,this.innerScope);for(f.data[this.index]=e.key,f.data[this.item]=e.value,e.nodes=[],b=0,c=this.childNodes.length;c>b;b++)d=this.childNodes[b].cloneNode(!0),e.nodes.push(d),this.iterations[a+1]&&this.iterations[a+1].nodes?this.element.insertBefore(d,this.iterations[a+1].nodes[0]):this.element.appendChild(d),d instanceof Element&&j(d).set(f)},react:function(a,b){if(a===p.SPLICE)this.splice.apply(this,[].slice.call(arguments,2));else if(a===p.SET){var c,d,e,f=b.split(".");if(f.length>1){for(e=f[1],c=0,d=this.iterations.length;d>c;c++)if(e==this.iterations[c].key){this.splice(c,1,1);break}}else this.parseChildren()}},splice:function(a,b,c){var d,e,f,g;for(d=a;a+b>d&&d in this.iterations;d++)for(e=0,f=this.iterations[d].nodes.length;f>e;e++)this.element.removeChild(this.iterations[d].nodes[e]);for(g=this.innerScope.resolve(this.list,!0),d=a;a+c>d;d++)this.iterations[d]={key:d,value:g[d]},this.iterate(d)}},j.bindings.on={init:function(){this.eventListeners={}},set:function(c){function d(a,b){return function(d){a.call(c.data,d,h.data,b)}}if(!b(this.declaration))throw new e('"on" binding expects a binding set, instead got '+this.declaration);for(var f,g,h=c;h&&h.parent;)h=h.parent;for(f in this.declaration)if(this.declaration.hasOwnProperty(f)&&(g=c.resolve(this.declaration[f],!0),a(g))){var i=d(g,this.element);f in this.eventListeners&&this.element.removeEventListener(f,this.eventListeners[f]),this.eventListeners[f]=i,this.element.addEventListener(f,i)}}},j.bindings.style={get:function(){return this.element.style},set:function(a){var b,c;if(this.declaration instanceof Object)for(b in this.declaration)this.declaration.hasOwnProperty(b)&&(c=a.resolve(this.declaration[b]),void 0!==c&&(this.element.style[b]=c));else if(c=a.resolve(this.declaration),c instanceof Object)for(b in c)c.hasOwnProperty(b)&&void 0!==c[b]&&(this.element.style[b]=c[b]);else this.element.setAttribute("style",c)}},j.bindings.template={set:function(a){var b=a.resolve(this.declaration),c=document.getElementById(b);if(null===c)throw new e("Template not found: "+b);this.element.innerHTML=c.innerHTML}},j.bindings.text={init:function(){this.element.databinding.innerScope=null},get:function(){return this.element.textContent},set:function(a){var b=a.resolve(this.declaration);void 0!==b&&(this.element.textContent=b)}},j.bindings.visible={get:function(){return!this.element.hidden},set:function(a,b){var c=a.resolve(this.declaration),d=Boolean(c)===Boolean(b);this.element.hidden=d,this.element.style.display=d?"none":""}},j.bindings["with"]={set:function(a){var b=a.resolve(this.declaration);this.element.databinding.innerScope=new h(b,a)}},j.extensions.between=function(a,b){var c=Array.isArray(this)?this.length:+this;return c>=a&&b>=c},j.extensions.capitalize=function(){return String(this).charAt(0).toUpperCase()+String(this).slice(1)},j.extensions.ceil=function(a){var b=Math.pow(10,0|a);return Math.ceil(b*+this)/b},j.extensions.date=function(){return new Date(this).toLocaleDateString()},j.extensions.equals=function(a){return this==a},j.extensions.every=j.extensions.all=function(a){return Array.isArray(this)&&this.every("function"==typeof a?a:function(b){return b[a]})},j.extensions.filter=function(a){return"string"==typeof a?Array.isArray(this)&&this.filter(function(b){return b[a]}):Array.isArray(this)?this.filter(a,this):[]},j.extensions.floor=function(a){var b=Math.pow(10,0|a);return Math.floor(b*+this)/b},j.extensions.lowercase=String.prototype.toLowerCase,j.extensions.moreThan=function(a){return(Array.isArray(this)?this.length:+this)>a},j.extensions.none=function(a){return null===this||void 0===this||0===this.length||Array.isArray(this)&&!this.some("function"==typeof f?f:function(a){return a[f]})},j.extensions.not=function(a){return Array.isArray(this)?this.filter(function(b){return!b[a]}):this!=a},j.extensions.number=function(){return Array.isArray(this)?this.length:Number(this)},j.extensions.round=function(a){var b=Math.pow(10,0|a);return Math.round(b*+this)/b},j.extensions.some=function(a){return void 0===a?(Array.isArray(this)?this.length:+this)>0:Array.isArray(this)&&this.some("function"==typeof a?a:function(b){return b[a]})},j.extensions.sort=function(a){return Array.isArray(this)?this.sort(a):[]},j.extensions.time=function(){return new Date(this).toLocaleTimeString()},j.extensions.trim=String.prototype.trim,j.extensions.uppercase=String.prototype.toUpperCase,j});